# (PART) 線性迴歸 Linear Regression {-}

# 簡單線性迴歸 Simple Linear Regression

## 一些背景和術語

思考下面這些問題：


1. 脂肪攝入量增加，會導致體重增加嗎？
2. 兒童成年時的身高，可以用父母親的身高來預測嗎？
3. 如果其他條件都沒有變化，飲食習慣的改變，是否能影響血清膽固醇的水平？

上面的問題中，自變量 (預測變量)，和因變量 (反應量) 分別是什麼？

你可能還會碰到像下面這些稱呼，他們都是一個意思：

- 因變量  Dependent variable = 反應量 response variable = 結果變量 outcome variable;
- 自變量  independent variable = 預測變量 predictor variable = 解釋變量  explanatory variable = 共變量 covariate.


所有的非簡單統計模型 (non-trivial statistical models) 都包括以下三個部分：

1. 隨機變量 random variables：
    - 因變量永遠都是隨機變量；
    - 預測變量不一定是隨機變量；
    - 在相對簡單的模型中，我們討論的因變量和預測變量幾乎都來自於從人羣中抽取觀察樣本收集來的數據。

2. 人羣參數 population parameters：
    - 人羣參數，是我們希望通過收集樣本獲得的數據來估計 (estimate) 的參數。

3. 對不確定性的描述 representation of uncertainty：
    - 不確定性，意爲因變量的變動中，沒有被預測變量解釋的部分。


其他的術語問題：


- **單一因變量**的統計模型：**univariate model**;
- **多個因變量**的統計模型： **multivariate model**;
- **單一因變量**，含有**多個預測變量**的統計模型：**multivariable model**；
- 在線性迴歸中，單一因變量，單一預測變量的統計模型：**simple linear regression** (簡單線性迴歸)；
- 在線性迴歸中，單一因變量，多個預測變量的統計模型：**multiple linear regression** (多重線性迴歸)；

儘量避免將預測變量 (predictor variable) 寫作自變量 (independent variable)，因爲 "independent" 有自己的統計學含義 (獨立)。然而我們在線性迴歸中使用的預測變量，不一定都**互相獨立**，所以容易讓人混淆其意義。


## 簡單線性迴歸模型 simple linear regression model

即：**單一因變量，單一預測變量**的統計模型。


### 例1
下面的散點圖 \@ref(fig:age-wt) 展示的是一項橫斷面調查的結果，調查的是一些兒童的年齡 (月)，和他們的體重 (千克) 之間的關係。

```{r age-wt, echo=FALSE, fig.asp=.7, fig.width=4, fig.cap='Age and weight of children in a cross-sectional survey', fig.align='center', out.width='80%'}
library(haven)
library(ggplot2)
library(ggthemes)
growgam1 <- read_dta("backupfiles/growgam1.dta")

ggplot(growgam1, aes(x=age, y=wt)) + geom_point(shape=20) +
  scale_x_continuous(breaks=seq(0, 38, 4),limits = c(0,36.5))+
  scale_y_continuous(breaks = seq(0, 20, 5),limits = c(0,20.5)) +
   theme_economist() +labs(x = "Age (Months)", y = "Weight (kg)")
```

### 例2

表 \@ref(tab:walk) 羅列的是11名兒童能夠自己獨立行走時的年齡。這些兒童在剛出生時被隨機分配到兩個組中 (積極鍛鍊走路，和對照組)。如果你熟悉均數比較，這樣的數據可以通過簡單 $t$ 檢驗來分析其均值的不同。但是實際上後面你會看到簡單 $t$ 檢驗和簡單線性迴歸是同一回事。


```{r walk, echo=FALSE}
library(knitr)
library(kableExtra)
dt <- read.csv("backupfiles/walking.csv", header = T)
dt$Eight.Week.Control.Group..n.5.[6] <- " -- "
kable(dt, "html",  col.names = c("Active Exercise (n=6)","Eight Week Control (n=5)"), align = "c",caption = "Childen's ages at time of first walking aline by randomisation group") %>%
  kable_styling(bootstrap_options = c("striped", "bordered")) %>%
#  collapse_rows(columns = c(1)) %>%
  add_header_above(c("Age in months for walking alone" = 2))
```

## 區分因變量和預測變量

在簡單兩樣本 $t$ 檢驗中，我們不區分那兩個要比較的數據 $(X, Y)$。所以 $X$ 和 $Y$ 的關係，同分析 $Y$ 和 $X$ 的關係是一樣的。表 \@ref(tab:walk) 的例子中，視“直立行走的年齡”這一變量爲因變量十分直觀且自然。圖 \@ref(fig:age-wt) 的例子中我們顯然可以關心是否可以用兒童的年齡來推測他/她的體重。所以年齡被視爲預測變量 $(X)$，體重被視爲因變量或者叫結果變量 $(Y)$。

### 均值 (期待值) 公式

圖 \@ref(fig:age-wt) 的例子中，當我們決定考察體重變化 $(Y)$ 和年齡的關係 $(X)$ 後，我們需要提出一個模型，來描述二者之間的關係。這個模型中，最重要的信息，是均值，或者叫期待值：

$$
E(Y|X=x), \text{ the expected value of } Y \text{ when } X \text{ takes the value } x
$$

在簡單線性迴歸模型中，我們認爲這個均值方程是線性關係：

$$
E(Y|X=x) = \alpha +\beta x
$$

所以這個線性關係中，有兩個參數 (parameters) 是我們關心的 $\alpha, \beta$。

- $\alpha$ 是截距 intecept。意爲當 $X$ 取 $0$時， $Y$ 的期待值大小；
- $\beta$ 是方程的斜率 slope。意爲當 $X$ 上升一個單位時，$Y$ 上升的期待值大小。

需要強調的是，這樣的線性模型，是我們提出，用來模擬真實數據時使用的。~~你如果作死~~當然還可以提出更加複雜的模型。如下面圖 \@ref(fig:age-wt-lm) 顯示的是線性迴歸直線， 而圖 \@ref(fig:age-wt-loess) 顯示的是較爲複雜的迴歸曲線。曲線方程可能更加擬合我們收集到的數據，然而這樣的連續的斜率變化很可能僅僅只解釋了這個樣本量數據，而不能解釋在人羣中年齡和體重的關係。





```{r age-wt-lm, echo=FALSE, fig.asp=.7, fig.width=4, fig.cap='Linear Mean Function for Age and weight of children in a cross-sectional survey', fig.align='center', out.width='80%'}
library(haven)
library(ggplot2)
library(ggthemes)
growgam1 <- read_dta("backupfiles/growgam1.dta")

ggplot(growgam1, aes(x=age, y=wt)) + geom_point(shape=20, colour="grey40") +
  stat_smooth(method = lm) +
  scale_x_continuous(breaks=seq(0, 38, 4),limits = c(0,36.5))+
  scale_y_continuous(breaks = seq(0, 20, 5),limits = c(0,20.5)) +
   theme_economist() +labs(x = "Age (Months)", y = "Weight (kg)")
```




```{r age-wt-loess, echo=FALSE, fig.asp=.7, fig.width=4, fig.cap='Non-linear Mean Function for Age and weight of children in a cross-sectional survey', fig.align='center', out.width='80%'}
library(haven)
library(ggplot2)
library(ggthemes)
growgam1 <- read_dta("backupfiles/growgam1.dta")

ggplot(growgam1, aes(x=age, y=wt)) + geom_point(shape=20, colour="grey40") +
  stat_smooth(method = loess, se=T) +
  scale_x_continuous(breaks=seq(0, 38, 4),limits = c(0,36.5))+
  scale_y_continuous(breaks = seq(0, 20, 5),limits = c(0,20.5)) +
   theme_economist() +labs(x = "Age (Months)", y = "Weight (kg)")
```

### 條件分佈和方差 the conditional distribution and the variance function

如果要完全明確一個統計模型，另一個重要的事情是，該模型能否準確描述因變量在預測變量的條件分佈 it is necessary to describe the ddistribution of the dependent variable conditional on the predictor variable。使用簡單線性迴歸模型有幾個前提假設，一是因變量對預測變量的條件分佈的方差是保持不變的 the variance of the dependent variable (conditional on the predictor variable) is constant。二是，這樣的條件分佈是一個正態分佈。有時候，這些假設條件並不能得到滿足。上面的散點圖 \@ref(fig:age-wt)看上去還算符合這兩個假設前提：在每一個年齡階段，體重的分佈沒有發生歪斜 (skew)，分散分佈 (方差) 也相對穩定。但是圖 \@ref(fig:diamond) 中的價格-克拉數據很明顯無法滿足上面的前提假設。在線性迴歸模型中，我們使用 $\sigma^2$ 表示殘差的方差 (residual variance)。

```{r diamond, echo=FALSE, fig.asp=.7, fig.width=4, fig.cap='Relationship between diamond carat and price', fig.align='center', out.width='80%'}
library(ggplot2)
library(ggthemes)
ggplot(data=diamonds, aes(x=carat, y=price)) + geom_point(shape=20)+
  theme_economist()
```

### 定義簡單線性迴歸模型

用來描述一個隨機變量 $(Y)$ 和另一個變量 $(X)$ 之間關係的簡單線性迴歸模型，被定義爲：

$$
(Y|X=x) \sim N(\alpha+\beta x, \sigma^2)
$$



# 最小二乘估計的性質和推斷 Ordinary Least Squares Estimators and Inference

# 方差分析 Introduction to Analysis of Variance

# 多元模型分析 Multivariable Models

# 多元模型分析的解釋
